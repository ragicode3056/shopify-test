{{ 'customer.css' | asset_url | stylesheet_tag }}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }
  form {
  display: flex;
  flex-direction: column;
  max-width: 400px;
  margin: 0 auto;
}
.card {
  border: 1px solid #ccc;
  padding: 10px;
  margin-bottom: 10px;
}
label {
  font-weight: bold;
  margin-bottom: 5px;
}

input[type="text"],
button {
  padding: 10px;
  margin-bottom: 10px;
  border: 1px solid #ccc;
  border-radius: 4px;
}

button {
  background-color: #4CAF50;
  color: white;
  cursor: pointer;
}

button:hover {
  background-color: #45a049;
}

input[type="text"]:focus {
  outline: none;
  border-color: #4CAF50;
}
  .test-box{
    width: 400px;
    height: 200px;
    border: 1px solid black;
    /* padding: 40px; */
    margin: 0 auto;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .test-parent a{
    margin-top:60px;
    display:flex;
  }
  .order-history {
  display: flex;
  flex-direction: column;
  margin: 20px;
}

.card-header {
  background-color: #f2f2f2;
  padding: 10px;
}

.card-body {
  display: flex;
  flex-direction: column;
}

.order-card {
  border: 1px solid #ccc;
  border-radius: 4px;
  margin-bottom: 10px;
  padding: 10px;
}

.order-details {
  display: flex;
  flex-direction: column;
}

.order-number a {
  font-weight: bold;
  color: #333;
  text-decoration: none;
}

.order-date,
.order-payment,
.order-fulfillment,
.order-total {
  display: flex;
  justify-content: space-between;
  margin-top: 5px;
}

.order-actions {
  margin-top: 10px;
}

.order-actions button {
  background-color: #4caf50;
  color: #fff;
  border: none;
  border-radius: 4px;
  padding: 6px 12px;
  cursor: pointer;
}

.order-actions button:hover {
  background-color: #45a049;
}

  /* Popup styles */
  .popup {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 300px;
    padding: 20px;
    background-color: #f1f1f1;
    border: 1px solid #ccc;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    z-index: 9999;
    display: none;
  }

  .popup h2 {
    margin-top: 0;
  }

  .popup input[type="text"] {
    width: 100%;
    padding: 10px;
    margin-bottom: 10px;
    box-sizing: border-box;
  }

  .popup button {
    padding: 10px 20px;
  }
{%- endstyle -%}
<div class="test-parent" id="my-div">
  
<!-- <form  method="POST" id="#orderForm" action="https://www.kisshosting.be/api_test/process_order.php"> -->
  <label for="order_number">Order Number:</label>
  <input type="text" id="order_number" name="order_number" required>

   <label for="order_date">Order Date:</label>
  <input type="date" id="order_date" name="order_date" required>

  <label for="postal_code">Postal Code:</label>
  <input type="text" id="postal_code" name="postal_code" required>


  <button type="submit" id="formSubmit" onclick=submitForm()>Continue</button>
  <div id="cardContainer"></div>
<!-- </form> -->
<div id="exchangePopupNonLogged" class="popup">
  <h2>Exchange Order</h2>
  <p>Order Number: <span id="popupOrderNumber"></span></p>
  <p>Order Total: <span id="popupOrderTotal"></span></p>
  <input type="text" id="reasonInput" placeholder="Why are you returning?" />
  <button onclick="closePopup()">Continue</button>
</div>
<div id="thanksPopupNonLogged" class="popup">
 
  <p>wij hebben uw verzoek om een toestel terug te sturen goed ontvangen. U ontvangt binnen de 2 werkdagen een mailtje met de nodige info om het toestel op te sturen</p>
  <button onclick="closeThanksPopup()">Close</button>
</div>
 
<script>
  function submitForm() {
    console.log("submit form ")
    let orderNumber = document.getElementById('order_number').value;
    let postalCode = document.getElementById('postal_code').value;
    let orderDate = document.getElementById('order_date').value;
    console.log(orderNumber,postalCode,orderDate);
    
      $.ajax({
        url: 'https://www.kisshosting.be/api_test/process_order.php',
        method: 'POST',
        data: {
          order_number: orderNumber, // get by queryselector
          postal_code: postalCode
        },
    
        success: function(response) {
          
          // extract array from response
var startIndex = response.indexOf('['); // Find the start of the JSON array
var endIndex = response.lastIndexOf(']'); // Find the end of the JSON array

if (startIndex !== -1 && endIndex !== -1) {
  var jsonSubstring = response.substring(startIndex, endIndex + 1);
  var jsonArray = JSON.parse(jsonSubstring);

  console.log(jsonArray,"jsonArray"); // Display the array in the console
} else {
  console.error('Unable to extract JSON array from the response.');
}
      
          // var matchingOrders = response;
          // console.log(dataArray,"dataArray")
    document.getElementById('cardContainer').innerHTML = '';

  // Loop through each item and create a card
  jsonArray.forEach(function(order) {
    var orderDate = order.processed_at.split('T')[0];
    // Construct the card HTML
    var cardHTML = `
      <div class="card">
        <h3>${order.line_items[0].name}</h3>
        <p>Order Number : ${order.order_number}</p>
        <p>Order Date  : ${orderDate}</p>
        <p>Total Price : ${order.total_price}</p>
        <p>Quantity : ${order.line_items[0].quantity}</p>
         <p> Address :
            ${order.shipping_address.address1}
         ${order.shipping_address.city}
         ${order.shipping_address.zip}</p>
      </div>
        <button onclick="exchangeOrder(${order.total_price}, ${order.total_price})">Exchange</button>
    `;

    // Append the card HTML to the container
    document.getElementById('cardContainer').innerHTML += cardHTML;
    console.log(order.shipping_address,"shipping_address*****")
  });     
        },
        error: function(xhr, status, error) {
          // Handle AJAX error here
          console.log(error);
        }
      });
  }
   let s = document.getElementById('formSubmit');
  console.log(s,"s");
var orderNumberElement; // Declare the variables in a higher scope
  var orderTotalElement;

  function exchangeOrder(orderNumber, orderTotal) {
    // Open the first popup
    var popup = document.getElementById('exchangePopupNonLogged');
    popup.style.display = 'block';

    // Set the order number and order total in the first popup
    orderNumberElement = document.getElementById('popupOrderNumber'); // Assign the values to the variables
    orderNumberElement.textContent = orderNumber;

    orderTotalElement = document.getElementById('popupOrderTotal');
    orderTotalElement.textContent = orderTotal;
  }

  function closePopup() {
    // Close the first popup
    var popup = document.getElementById('exchangePopupNonLogged');
    popup.style.display = 'none';

    // Open the second popup
    var thanksPopup = document.getElementById('thanksPopupNonLogged');
    thanksPopup.style.display = 'block';

    // Get the entered reason
    var reasonInput = document.getElementById('reasonInput');
    var reason = reasonInput.value;

    // Log the order number, order total, and reason
    console.log('Order Number:', orderNumberElement.textContent);
    console.log('Order Total:', orderTotalElement.textContent);
    console.log('Reason:', reason);
  }

  function closeThanksPopup() {
    // Close the second popup
    var thanksPopup = document.getElementById('thanksPopupNonLogged');
    thanksPopup.style.display = 'none';
  }
    console.log({{ customer | json }},"customers")
</script>
<!--   $(document).ready(function() {
    $('#orderForm').submit(function(event) {
      console.log("submit clicked");
      event.preventDefault();

      var orderNumber = $('#order_number').val();
      var postalCode = $('#postal_code').val();
      var houseNumber = $('#house_number').val();

      $.ajax({
        url: 'https://www.kisshosting.be/api_test/process_order.php',
        method: 'POST',
        data: {
          order_number: orderNumber,
          postal_code: postalCode,
          house_number: houseNumber
        },
        success: function(response) {
          // Handle the response here
          console.log(response);
          // Update the UI with the matching orders
          var matchingOrders = JSON.parse(response);
          // Add your logic to display the matching orders on the UI
        },
        error: function(xhr, status, error) {
          // Handle AJAX error here
          console.log(error);
        }
      });
    });
  });
</script> -->

<!-- //   const ordersUrl = '5c8b10a7ee13ff1755736fd43618c064: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@testapp-5058.myshopify.com/admin/api/2023-04/orders.json';

  
//    console.log("check",ordersUrl);



// //  var ordersUrl = '/admin/api/2021-07/orders.json';
// $.ajax({
//   url: ordersUrl,
//   // headers: {
//   //   'X-Shopify-Access-Token': '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'
//   // },
//   dataType: 'json',
//   success: function(data) {
//     console.log("success",data);
//     var orders = data.orders;
//    console.log("orders");
//     console.log(orders);
//     var ordersHtml = '<table><thead><tr><th>Order ID</th><th>Product Name</th><th>Product Price</th><th>Product Quantity</th><th>Product Vendor</th> <th>Order Number</th><th>Order Status url</th><th>Prouduct Id</th></tr></thead><tbody>';
// for (var i = 0; i < orders.length; i++) {
//   var order = orders[i];
// for (var i = 0; i < orders.length; i++) {
//   var order = orders[i];
//   let productName = order.line_items[i].name;
//   let ProductId = order.line_items[i].id;
//   let productPrice = order.line_items[i].price;
//   let productQuantity = order.line_items[i].quantity;
//   let productVendor = order.line_items[i].vendor;
//   let productOrderNumber = order.line_items[i].order_number;
//   let productOrderStatusUrl = order.order_status_url;

  
//   console.log(productName);
//   var orderId = order.id;

//    var customerName = order.customer ? order.customer.first_name + ' ' + order.customer.last_name : '';
//   ordersHtml += '<tr><td>' + orderId + '</td><td>' + productName + '</td> <td>' + productPrice + '</td>  <td>' + productQuantity + '</td> <td>' + productVendor + '</td> <td>' + productOrderNumber + '</td> <td>' + productOrderStatusUrl + '</td><td>' + ProductId + '</td></tr>';
// }
// ordersHtml += '</tbody></table>';

//    ordersHtml += '</tbody></table>';
//  // Append another table
//     ordersHtml += '<br/>';
//     ordersHtml += '<h4> plan is customer infor will be mailed to vendor </h4>'
//    ordersHtml += '<table>';
   
//     let customerEmail = order.customer.email;
//     let customerId = order.customer.id ;
    
//     ordersHtml += '<thead><tr><th>Customer Name</th><th>Customer Email</th><th>Customer Id</th></tr></thead><tbody>';
//     ordersHtml += '<tr><td>' + customerName + '</td><td>' + customerEmail + '</td> <td>' + customerId + '</td> </tr>';
//     // Add rows for product data
//     ordersHtml += '</tbody></table>';

//     $('#orders-container').html(ordersHtml);
    
//   }
//   }
//   // error: function(jqXHR, textStatus, errorThrown) {
//   //   console.log("error")
//   // }
// });




 -->

<!-- </script> -->
<!-- 
<h3>Order Info</h3>
<div id="orders-container"></div>
<div id="customer-details-container"></div> -->